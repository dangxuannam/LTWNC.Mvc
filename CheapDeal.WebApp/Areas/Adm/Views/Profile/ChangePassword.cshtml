@model CheapDeal.WebApp.Models.ChangePasswordViewModel
@{
    ViewBag.Title = "Đổi mật khẩu";
}

<div class="row">
    <div class="col-lg-8 col-lg-offset-2">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5><i class="fa fa-key"></i> Đổi mật khẩu</h5>
            </div>
            <div class="ibox-content">
                @if (TempData["Success"] != null)
                {
                    <div class="alert alert-success alert-dismissible">
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                        <i class="fa fa-check-circle"></i> @TempData["Success"]
                    </div>
                }

                <div class="alert alert-info">
                    <h4><i class="fa fa-info-circle"></i> Lưu ý bảo mật:</h4>
                    <ul class="m-b-none">
                        <li>Mật khẩu phải có ít nhất 6 ký tự</li>
                        <li>Nên sử dụng kết hợp chữ hoa, chữ thường, số và ký tự đặc biệt</li>
                        <li>Không sử dụng mật khẩu quá đơn giản</li>
                        <li>Không chia sẻ mật khẩu với bất kỳ ai</li>
                    </ul>
                </div>

                @using (Html.BeginForm("ChangePassword", "Profile", FormMethod.Post, new { @class = "form-horizontal" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })

                    <div class="form-group">
                        @Html.LabelFor(m => m.OldPassword, new { @class = "col-sm-4 control-label" })
                        <div class="col-sm-8">
                            <div class="input-group">
                                @Html.PasswordFor(m => m.OldPassword, new { @class = "form-control", id = "oldPassword", placeholder = "Nhập mật khẩu hiện tại" })
                                <span class="input-group-btn">
                                    <button class="btn btn-default toggle-password" type="button" data-target="oldPassword">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                </span>
                            </div>
                            @Html.ValidationMessageFor(m => m.OldPassword, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>

                    <div class="form-group">
                        @Html.LabelFor(m => m.NewPassword, new { @class = "col-sm-4 control-label" })
                        <div class="col-sm-8">
                            <div class="input-group">
                                @Html.PasswordFor(m => m.NewPassword, new { @class = "form-control", id = "newPassword", placeholder = "Nhập mật khẩu mới" })
                                <span class="input-group-btn">
                                    <button class="btn btn-default toggle-password" type="button" data-target="newPassword">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                </span>
                            </div>
                            @Html.ValidationMessageFor(m => m.NewPassword, "", new { @class = "text-danger" })

                            <div class="password-strength m-t-sm">
                                <div class="progress" style="height: 5px; margin-bottom: 5px;">
                                    <div id="strengthBar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
                                </div>
                                <small id="strengthText" class="text-muted">Độ mạnh: <span></span></small>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(m => m.ConfirmPassword, new { @class = "col-sm-4 control-label" })
                        <div class="col-sm-8">
                            <div class="input-group">
                                @Html.PasswordFor(m => m.ConfirmPassword, new { @class = "form-control", id = "confirmPassword", placeholder = "Xác nhận mật khẩu mới" })
                                <span class="input-group-btn">
                                    <button class="btn btn-default toggle-password" type="button" data-target="confirmPassword">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                </span>
                            </div>
                            @Html.ValidationMessageFor(m => m.ConfirmPassword, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>

                    <div class="form-group">
                        <div class="col-sm-8 col-sm-offset-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="fa fa-save"></i> Đổi mật khẩu
                            </button>
                            <a href="@Url.Action("Index")" class="btn btn-white">
                                <i class="fa fa-times"></i> Hủy
                            </a>
                        </div>
                    </div>
                }
            </div>
        </div>
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5><i class="fa fa-history"></i> Lịch sử bảo mật</h5>
            </div>
            <div class="ibox-content">
                <p class="text-muted">
                    <i class="fa fa-clock-o"></i> Lần đổi mật khẩu gần nhất:
                    <strong>Chưa có dữ liệu</strong>
                </p>
                <p class="text-muted">
                    <i class="fa fa-shield"></i> Tài khoản của bạn được bảo vệ bởi mật khẩu mã hóa
                </p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>$(document).ready(function () {
            $('.toggle-password').click(function () {
                var target = $(this).data('target');
                var input = $('#' + target);
                var icon = $(this).find('i');

                if (input.attr('type') === 'password') {
                    input.attr('type', 'text');
                    icon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    input.attr('type', 'password');
                    icon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });

            $('#newPassword').on('keyup', function () {
                var password = $(this).val();
                var strength = checkPasswordStrength(password);

                var strengthBar = $('#strengthBar');
                var strengthText = $('#strengthText span');

                strengthBar.removeClass('progress-bar-danger progress-bar-warning progress-bar-info progress-bar-success');

                if (strength === 0) {
                    strengthBar.css('width', '0%');
                    strengthText.text('');
                } else if (strength === 1) {
                    strengthBar.css('width', '25%').addClass('progress-bar-danger');
                    strengthText.text('Yếu').css('color', '#ed5565');
                } else if (strength === 2) {
                    strengthBar.css('width', '50%').addClass('progress-bar-warning');
                    strengthText.text('Trung bình').css('color', '#f8ac59');
                } else if (strength === 3) {
                    strengthBar.css('width', '75%').addClass('progress-bar-info');
                    strengthText.text('Mạnh').css('color', '#23c6c8');
                } else {
                    strengthBar.css('width', '100%').addClass('progress-bar-success');
                    strengthText.text('Rất mạnh').css('color', '#1ab394');
                }
            });

            function checkPasswordStrength(password) {
                var strength = 0;

                if (password.length === 0) return 0;
                if (password.length >= 6) strength++;
                if (password.length >= 10) strength++;
                if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
                if (/\d/.test(password)) strength++;
                if (/[^a-zA-Z0-9]/.test(password)) strength++;

                return Math.min(strength, 4);
            }

            setTimeout(function () {
                $('.alert-success').fadeOut('slow');
            }, 5000);
        });
    </script>
}

