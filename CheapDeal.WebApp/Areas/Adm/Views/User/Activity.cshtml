@model List<CheapDeal.WebApp.Models.UserActivityLog>
@{
    ViewBag.Title = "Nhật ký hoạt động";
}

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Nhật ký hoạt động</h2>
        <ol class="breadcrumb">
            <li><a href="@Url.Action("Index", "Home", new { Area = "Adm" })">Trang chủ</a></li>
            <li><a href="@Url.Action("Index")">Người dùng</a></li>
            <li class="active"><strong>Nhật ký</strong></li>
        </ol>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox">
                <div class="ibox-title">
                    <h5>Lịch sử hoạt động của người dùng</h5>
                </div>
                <div class="ibox-content">
                    @using (Html.BeginForm("Activity", "User", FormMethod.Get, new { @class = "form-horizontal" }))
                    {
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Người dùng</label>
                            <div class="col-sm-10">
                                @Html.DropDownList("accountId", (SelectList)ViewBag.Users, "-- Tất cả --", new { @class = "form-control" })
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">Từ ngày</label>
                            <div class="col-sm-3">
                                <input type="date" name="fromDate" value="@ViewBag.FromDate?.ToString(" yyyy-MM-dd")" class="form-control" />
                            </div>

                            <label class="col-sm-2 control-label">Đến ngày</label>
                            <div class="col-sm-3">
                                <input type="date" name="toDate" value="@ViewBag.ToDate?.ToString(" yyyy-MM-dd")" class="form-control" />
                            </div>

                            <div class="col-sm-2">
                                <button type="submit" class="btn btn-primary btn-block">
                                    <i class="fa fa-search"></i> Tìm kiếm
                                </button>
                            </div>
                        </div>
                    }

                    <hr />

                    <p class="text-muted">
                        <i class="fa fa-info-circle"></i>
                        Tổng: <strong>@ViewBag.TotalRecords</strong> hoạt động
                    </p>

                    <div class="feed-activity-list">
                        @if (Model != null && Model.Any())
                        {
                            foreach (var activity in Model)
                            {
                                <div class="feed-element">
                                    <a href="#" class="pull-left">
                                        <img alt="avatar" class="rounded-circle" src="~/Content/images/avatar-default.png"
                                             style="width: 40px; height: 40px;">
                                    </a>
                                    <div class="media-body">
                                        <small class="pull-right text-navy">
                                            @activity.Timestamp.ToString("dd/MM/yyyy HH:mm:ss")
                                        </small>
                                        <strong>@activity.Account.UserName</strong>
                                        <span class="label label-info m-l-xs">@activity.ActivityType</span>
                                        <br />

                                        @if (!string.IsNullOrEmpty(activity.Description))
                                        {
                                            <small class="text-muted">@activity.Description</small>
                                            <br />
                                        }

                                        <small class="text-muted">
                                            <i class="fa fa-map-marker"></i> IP: @activity.IpAddress
                                        </small>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="text-center text-muted p-lg">
                                <i class="fa fa-inbox fa-4x"></i>
                                <p>Không có hoạt động nào</p>
                            </div>
                        }
                    </div>
                    @if (ViewBag.TotalPages > 1)
                    {
                        <div class="text-center">
                            <ul class="pagination">
                                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                                {
                                    <li class="@(i == ViewBag.Page ? "active" : "")">
                                        <a href="@Url.Action("Activity", new {
                                            accountId = ViewBag.AccountId,
                                            fromDate = ViewBag.FromDate?.ToString("yyyy-MM-dd"),
                                            toDate = ViewBag.ToDate?.ToString("yyyy-MM-dd"),
                                            page = i
                                        })">@i</a>
                                    </li>
                                }
                            </ul>
                            <p class="text-muted">
                                Trang @ViewBag.Page / @ViewBag.TotalPages
                            </p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
